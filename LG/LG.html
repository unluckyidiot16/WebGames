<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ìƒ ìš”ì•½: 19ì„¸ë¶€í„° 30ì„¸ê¹Œì§€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .stat-bar-bg { background-color: #e5e7eb; border-radius: 9999px; height: 12px; overflow: hidden; }
        .stat-bar-fill { height: 100%; transition: width 0.5s ease-in-out; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 20px; z-index: 50; transition: opacity 0.5s; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col">

<!-- ê²Œì„ ì»¨í…Œì´ë„ˆ -->
<div class="max-w-md mx-auto w-full bg-white shadow-xl flex flex-col relative">

    <!-- ìƒë‹¨: ìƒíƒœì°½ -->
    <header class="p-4 bg-slate-800 text-white shrink-0">
        <div class="flex justify-between items-center mb-2">
            <div>
                <span class="text-xl font-bold" id="age-display">19ì„¸</span>
                <span class="text-sm text-gray-300 ml-2" id="job-display">ê³ 3 ìˆ˜í—˜ìƒ</span>
            </div>
            <div class="font-mono text-yellow-400 font-bold" id="money-display">ğŸ’¸ 0ë§Œì›</div>
        </div>

        <div class="grid grid-cols-1 gap-2 text-xs">
            <div class="flex items-center">
                <span class="w-6 mr-1">ğŸ§ </span>
                <div class="w-full stat-bar-bg"><div id="mental-bar" class="stat-bar-fill bg-blue-500" style="width: 80%"></div></div>
            </div>
            <div class="flex items-center">
                <span class="w-6 mr-1">ğŸ’Š</span>
                <div class="w-full stat-bar-bg"><div id="health-bar" class="stat-bar-fill bg-green-500" style="width: 80%"></div></div>
            </div>
            <div class="flex items-center">
                <span class="w-6 mr-1">ğŸ™</span>
                <div class="w-full stat-bar-bg"><div id="hunger-bar" class="stat-bar-fill bg-orange-400" style="width: 80%"></div></div>
            </div>
        </div>
    </header>

    <!-- ì¤‘ì•™: ë©”ì¸ ì½˜í…ì¸  (ìŠ¤í¬ë¡¤ ê°€ëŠ¥) -->
    <main id="game-screen" class="flex-1 p-4 flex flex-col pb-24">
        <!-- í…ìŠ¤íŠ¸ ì˜ì—­ -->
        <div id="story-area" class="mb-6 fade-in">
            <h1 class="text-2xl font-bold mb-4 text-slate-800">ì¸ìƒ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘</h1>
            <p class="text-gray-600 leading-relaxed">
                ë‹¹ì‹ ì€ í˜„ì¬ 19ì„¸, ê³ ë“±í•™êµ 3í•™ë…„ì…ë‹ˆë‹¤.<br>
                ìˆ˜ëŠ¥ì´ ì½”ì•ìœ¼ë¡œ ë‹¤ê°€ì™”ìŠµë‹ˆë‹¤.<br>
                ë‹¹ì‹ ì˜ ì„ íƒì´ 30ì„¸ê¹Œì§€ì˜ ì¸ìƒì„ ê²°ì •í•©ë‹ˆë‹¤.
            </p>
        </div>

        <!-- ì´ë²¤íŠ¸ ê²°ê³¼/ë¡œê·¸ ì˜ì—­ -->
        <div id="log-area" class="bg-gray-50 p-3 rounded-lg border border-gray-200 text-sm text-gray-500 mb-4 h-32 overflow-y-auto hidden">
        </div>

        <div class="flex-1"></div> <!-- ê³µê°„ ì±„ìš°ê¸° -->

        <!-- ì„ íƒì§€ ë²„íŠ¼ ì˜ì—­ -->
        <div id="choices-area" class="grid grid-cols-1 gap-3 mt-4">
            <button class="w-full py-3 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-bold shadow transition transform active:scale-95">
                ê²Œì„ ì‹œì‘
            </button>
        </div>
    </main>
</div>

<!-- ì—”ë”© ëª¨ë‹¬ -->
<div id="ending-modal" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-lg p-6 max-w-sm w-full text-center fade-in overflow-y-auto max-h-[90vh]">
        <h2 class="text-2xl font-bold mb-2">ğŸ‰ 30ì„¸ ì¸ìƒ ê²°ì‚° ğŸ‰</h2>
        <div id="ending-content" class="text-left space-y-4 text-sm mb-6">
            <!-- ì—”ë”© ë‚´ìš© -->
        </div>
        <button onclick="location.reload()" class="w-full py-3 bg-slate-800 text-white rounded font-bold">ë‹¤ì‹œ íƒœì–´ë‚˜ê¸°</button>
    </div>
</div>

<script>
    // --- ê²Œì„ ë°ì´í„° ë° ìƒíƒœ ---
    const gameState = {
        age: 19,
        maxAge: 30,
        money: 0, // ë§Œì› ë‹¨ìœ„
        stats: {
            mental: 80, // 0~100
            health: 80, // 0~100
            hunger: 80  // 0~100
        },
        job: 'ê³ 3 í•™ìƒ',
        jobTier: 0, // ì§ì—… ë“±ê¸‰ (ìˆ˜ì… ê´€ë ¨)
        location: 'ë³¸ê°€', // ë³¸ê°€, ì„œìš¸ìì·¨
        degree: 'ê³ ì¡¸', // ê³ ì¡¸, ëŒ€í•™ì¬í•™, ëŒ€ì¡¸
        university: null, // null, 'ì˜ëŒ€', 'ëª…ë¬¸ëŒ€', 'ì§€ë°©ëŒ€'
        history: [],
        isGameOver: false,

        // íˆë“  ìŠ¤íƒ¯
        spec: 0,             // ì´ë ¥ì„œ/ìŠ¤í™(í•™ì , ìê²©ì¦ ë“±)
        careerPath: null,    // 'study' | 'job' | 'creative' | 'social' ...
        careerSkill: 0,      // í•´ë‹¹ ì§„ë¡œ ì ì„± ë ˆë²¨
        isMarried: false,

        // 1ë…„ = 4íšŒ í–‰ë™
        turnsPerYear: 4,
        turnInYear: 0 // 0~3 (0ì´ë©´ "1/4 í–‰ë™" ìƒíƒœ)
    };

    // --- ìƒìˆ˜ ë° ì„¤ì • ---
    const SETTINGS = {
        rent: { 'ë³¸ê°€': 0, 'ì„œìš¸ìì·¨': 600 }, // ì—°ê°„ ì£¼ê±°ë¹„ (ë§Œì›)
        foodCost: 300, // ì—°ê°„ ì‹ë¹„ ê¸°ì´ˆ
        salary: {
            'ë°±ìˆ˜': 0,
            'ì•Œë°”': 1200,
            'ìœ íŠœë²„': 0, // ë³„ë„ ê³„ì‚°
            'ì¤‘ì†Œê¸°ì—…': 2800,
            'ëŒ€ê¸°ì—…': 4500,
            'ì „ë¬¸ì§': 8000,
            'ê³µë¬´ì›': 3200
        }
    };

    // ğŸ’° ìê¸ˆ/ê²Œì„ì˜¤ë²„ ê´€ë ¨ í•œë„
    const LIMITS = {
        minMoney: -2000 // -2000ë§Œì›ê¹Œì§€ ëŒ€ì¶œ, ì´ ê°’ì— ë„ë‹¬í•˜ë©´ ê²Œì„ ì˜¤ë²„
    };

    // ğŸ² ì‹œì‘ ìê¸ˆ ë²”ìœ„ (0ë§Œì› ~ 1000ë§Œì› ì‚¬ì´ ëœë¤)
    const START_MONEY_MIN = 0;
    const START_MONEY_MAX = 1000;

    function getRandomStartMoney() {
        return Math.floor(Math.random() * (START_MONEY_MAX - START_MONEY_MIN + 1)) + START_MONEY_MIN;
    }


    // --- DOM ìš”ì†Œ ---
    const ui = {
        age: document.getElementById('age-display'),
        job: document.getElementById('job-display'),
        money: document.getElementById('money-display'),
        mentalBar: document.getElementById('mental-bar'),
        healthBar: document.getElementById('health-bar'),
        hungerBar: document.getElementById('hunger-bar'),
        story: document.getElementById('story-area'),
        choices: document.getElementById('choices-area'),
        log: document.getElementById('log-area'),
        endingModal: document.getElementById('ending-modal'),
        endingContent: document.getElementById('ending-content')
    };

    // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
    function updateUI() {
        const turnLabel = (gameState.age >= 20 && !gameState.isGameOver)
            ? ` Â· í–‰ë™ ${gameState.turnInYear + 1}/${gameState.turnsPerYear}`
            : '';
        ui.age.innerText = `${gameState.age}ì„¸${turnLabel}`;
        ui.job.innerText = `${gameState.location} / ${gameState.job}`;
        ui.money.innerText = `ğŸ’¸ ${gameState.money.toLocaleString()}ë§Œì›`;

        ui.mentalBar.style.width = `${gameState.stats.mental}%`;
        ui.mentalBar.className = `stat-bar-fill ${getStatColor(gameState.stats.mental)}`;

        ui.healthBar.style.width = `${gameState.stats.health}%`;
        ui.healthBar.className = `stat-bar-fill ${getStatColor(gameState.stats.health)}`;

        ui.hungerBar.style.width = `${gameState.stats.hunger}%`;
        ui.hungerBar.className = `stat-bar-fill ${getStatColor(gameState.stats.hunger, true)}`;
    }

    function getStatColor(value, isHunger = false) {
        if (value <= 20) return 'bg-red-500';
        if (value <= 50) return 'bg-yellow-500';
        return isHunger ? 'bg-orange-400' : (value > 80 ? 'bg-green-500' : 'bg-blue-500');
    }

    function addLog(text) {
        ui.log.classList.remove('hidden');
        const p = document.createElement('p');
        p.innerText = `- ${text}`;
        ui.log.prepend(p);
        gameState.history.push(`${gameState.age}ì„¸: ${text}`);
    }

    function showToast(msg) {
        const toast = document.createElement('div');
        toast.className = 'toast fade-in';
        toast.innerText = msg;
        document.body.appendChild(toast);
        setTimeout(() => {
            toast.style.opacity = '0';
            setTimeout(() => toast.remove(), 500);
        }, 2000);
    }

    function changeStat(type, amount) {
        if (gameState.isGameOver) return;

        gameState.stats[type] = Math.min(100, Math.max(0, gameState.stats[type] + amount));
        let icon = type === 'mental' ? 'ğŸ§ ' : (type === 'health' ? 'ğŸ’Š' : 'ğŸ™');
        let sign = amount >= 0 ? '+' : '';
        showToast(`${icon} ${sign}${amount}`);
        updateUI();

        // ë³€í™” í›„ ì¦‰ì‹œ ê²Œì„ ì˜¤ë²„ ì¡°ê±´ ì²´í¬
        checkGameOver();
    }

    function changeMoney(amount) {
        if (gameState.isGameOver) return;

        gameState.money += amount;
        let sign = amount >= 0 ? '+' : '';
        showToast(`ğŸ’¸ ${sign}${amount}ë§Œì›`);
        updateUI();

        // ë³€í™” í›„ ì¦‰ì‹œ ê²Œì„ ì˜¤ë²„ ì¡°ê±´ ì²´í¬
        checkGameOver();
    }

    function checkGameOver() {
        if (gameState.isGameOver) return true;

        // ë©˜íƒˆ 0
        if (gameState.stats.mental <= 0) {
            endGame("ì •ì‹ ë ¥ì´ ë°”ë‹¥ë‚¬ìŠµë‹ˆë‹¤. (ë©˜íƒˆ 0)");
            return true;
        }

        // ì²´ë ¥ 0
        if (gameState.stats.health <= 0) {
            endGame("ê±´ê°• ì•…í™”ë¡œ ì“°ëŸ¬ì¡ŒìŠµë‹ˆë‹¤. (ê±´ê°• 0)");
            return true;
        }

        // ë°°ê³ í”” 0
        if (gameState.stats.hunger <= 0) {
            endGame("ê·¹ì‹¬í•œ í—ˆê¸° ìƒíƒœì…ë‹ˆë‹¤. (ë°°ê³ í”” 0)");
            return true;
        }

        // ìê¸ˆ -2000ë§Œì› ì´í•˜
        if (gameState.money <= LIMITS.minMoney) {
            endGame(`ëŒ€ì¶œ í•œë„ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. (ìê¸ˆ ${gameState.money.toLocaleString()}ë§Œì›)`);
            return true;
        }

        return false;
    }


    function setStory(title, desc) {
        ui.story.innerHTML = `
            <h2 class="text-xl font-bold mb-3 text-indigo-900">${title}</h2>
            <p class="text-gray-700 leading-relaxed whitespace-pre-line">${desc}</p>
        `;
    }

    function setChoices(options) {
        ui.choices.innerHTML = '';
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = "w-full py-3 px-4 bg-white border-2 border-slate-200 hover:border-indigo-500 hover:bg-indigo-50 text-slate-800 rounded-lg font-bold shadow-sm transition flex flex-col items-center justify-center gap-1 mb-2";

            let html = `<span class="text-base">${opt.text}</span>`;
            if (opt.sub) html += `<span class="text-xs text-gray-400 font-normal">${opt.sub}</span>`;

            btn.innerHTML = html;
            btn.onclick = () => {
                // ğŸ’° ë¹„ìš©ì´ ìˆëŠ” ì„ íƒì§€ì¼ ë•Œë§Œ ì²˜ë¦¬
                if (opt.cost) {
                    // ì´ ì„ íƒì„ í–ˆì„ ë•Œ ì˜ˆìƒ ìê¸ˆ
                    const nextMoney = gameState.money - opt.cost;

                    // ğŸ”» ì´ ì„ íƒìœ¼ë¡œ -2000 ì•„ë˜ë¡œ ë–¨ì–´ì§€ë©´ ì„ íƒ ë¶ˆê°€
                    if (nextMoney < LIMITS.minMoney) {
                        showToast("ì´ ì„ íƒì„ í•˜ë©´ ëŒ€ì¶œ í•œë„ë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤!");
                        return;
                    }

                    // ğŸ’¸ ì‹¤ì œë¡œ ëˆ ì°¨ê° (ìŒìˆ˜ë¡œ ì§„ì… ê°€ëŠ¥)
                    changeMoney(-opt.cost);

                    // ì—¬ê¸°ì„œ ë°”ë¡œ -2000ì´ ë˜ë©´ checkGameOver()ì— ì˜í•´ ì—”ë”© ì²˜ë¦¬
                    if (gameState.isGameOver) return;
                }

                // ë¹„ìš© ì²˜ë¦¬ ëë‚˜ê³  ì‹¤ì œ ì•¡ì…˜ ìˆ˜í–‰
                opt.action();
            };
            ui.choices.appendChild(btn);
        });
    }


    // --- ğŸ² d20 & íˆë“  ìŠ¤íƒ¯ ì‹œìŠ¤í…œ ---
    function rollD20() {
        return Math.floor(Math.random() * 20) + 1;
    }

    function getCareerBonus(tag) {
        if (!tag) return 0;
        if (!gameState.careerPath) return 0;
        return gameState.careerPath === tag ? (gameState.careerSkill || 0) * 2 : 0;
    }

    function rollCheck({ dc, tag, description }) {
        const d20 = rollD20();
        const bonus = getCareerBonus(tag);
        const total = d20 + bonus;
        addLog(`${description} (d20=${d20}, ë³´ë„ˆìŠ¤=${bonus}, í•©ê³„=${total} / ëª©í‘œ ${dc})`);
        return { success: total >= dc, roll: d20, bonus, total, dc, tag };
    }

    function applyCareerGrowth(tag, success) {
        if (!tag) return;
        if (!gameState.careerPath) {
            gameState.careerPath = tag;
        }
        if (success && gameState.careerPath === tag) {
            gameState.careerSkill = (gameState.careerSkill || 0) + 1;
            addLog(`ì§„ë¡œ ê´€ë ¨ ê²½í—˜ì´ ìŒ“ì˜€ìŠµë‹ˆë‹¤. (íˆë“  ì ì„± Lv.${gameState.careerSkill})`);
        }
    }

    function resolveChoice({ dc, tag, description, onSuccess, onFail }) {
        const result = rollCheck({ dc, tag, description });
        if (result.success) {
            showToast("âœ… ì„±ê³µ!");
            applyCareerGrowth(tag, true);
            onSuccess && onSuccess(result);
        } else {
            showToast("âŒ ì‹¤íŒ¨...");
            applyCareerGrowth(tag, false);
            onFail && onFail(result);
        }
    }

    function getAdjustedDc(baseDc) {
        let dc = baseDc;
        if (gameState.university === 'ì˜ëŒ€') dc -= 4;
        else if (gameState.university === 'ëª…ë¬¸ëŒ€') dc -= 2;

        if (gameState.spec) {
            dc -= Math.min(3, gameState.spec);
        }

        return Math.max(8, dc);
    }

    // --- ì—°ë§ ì •ì‚° (1ë…„ì— 1ë²ˆë§Œ ì‹¤í–‰) ---
    function processAnnualEvent() {
        addLog(`${gameState.age}ì„¸ì˜ 1ë…„ì´ ì§€ë‚˜ê°”ìŠµë‹ˆë‹¤.`);

        // 1. ì£¼ê±°ë¹„ ë° ì‹ë¹„
        const rent = SETTINGS.rent[gameState.location];
        const food = SETTINGS.foodCost;
        let costMsg = `ìƒí™œë¹„ ì§€ì¶œ (ì‹ë¹„ ${food}`;
        if (rent > 0) costMsg += `, ì›”ì„¸ ${rent}`;
        costMsg += `)`;

        changeMoney(-(rent + food));
        addLog(costMsg);

        // 2. ë°°ê³ í”” ì²´í¬
        if (gameState.stats.hunger < 30) {
            changeStat('health', -10);
            changeStat('mental', -10);
            addLog("ë°°ê³ í””ì— ì‹œë‹¬ë ¤ ê±´ê°•ê³¼ ë©˜íƒˆì´ ë‚˜ë¹ ì§‘ë‹ˆë‹¤.");
        }
        gameState.stats.hunger = 50;

        // 3. ì§ì—… ìˆ˜ì… (í•™ìƒ/ì·¨ì¤€ìƒ/ì¬ìˆ˜ìƒ ì œì™¸)
        if (
            gameState.job !== 'ëŒ€í•™ìƒ' &&
            gameState.job !== 'ê³ 3 í•™ìƒ' &&
            gameState.job !== 'ì·¨ì¤€ìƒ' &&
            gameState.job !== 'ì¬ìˆ˜ìƒ'
        ) {
            let income = 0;
            if (gameState.job === 'ìœ íŠœë²„') {
                const d20 = rollD20();
                const bonus = getCareerBonus('creative');
                const total = d20 + bonus;
                addLog(`ì˜¬í•´ ìœ íŠœë¸Œ ì„±ê³¼ë¥¼ êµ´ë¦½ë‹ˆë‹¤. (d20=${d20}, ë³´ë„ˆìŠ¤=${bonus}, í•©ê³„=${total})`);

                if (total >= 20) {
                    income = 4000 + gameState.jobTier * 1500;
                    gameState.jobTier++;
                    addLog("ì˜ìƒì´ ëŒ€ë°•! ì±„ë„ì´ í¬ê²Œ ì„±ì¥í–ˆìŠµë‹ˆë‹¤. (í‹°ì–´ ìƒìŠ¹)");
                } else if (total >= 13) {
                    income = 2000 + gameState.jobTier * 800;
                    addLog("ê¾¸ì¤€í•œ ì¡°íšŒìˆ˜ê°€ ë‚˜ì™”ìŠµë‹ˆë‹¤.");
                } else {
                    income = 300;
                    changeStat('mental', -10);
                    addLog("ì¡°íšŒìˆ˜ê°€ ë°”ë‹¥ì„ ì³¤ìŠµë‹ˆë‹¤... ê´‘ê³ ë¹„ë§Œ ê¹”ì§ ë“¤ì–´ì˜µë‹ˆë‹¤.");
                }
            } else {
                income = SETTINGS.salary[gameState.job] || SETTINGS.salary['ì•Œë°”'];
            }
            changeMoney(income);
            addLog(`${gameState.job} ìˆ˜ì…: +${income}ë§Œì›`);
        }

        updateUI();
    }

    // --- ë‚˜ì´ì— ë”°ë¥¸ í˜ì´ì¦ˆ ë¶„ê¸° ---
    function showPhaseForCurrentAge() {
        if (gameState.isGameOver) return;

        if (gameState.age <= 19) {
            initGame();
            return;
        }

        if (gameState.age <= 26) {
            phaseUniversityEra();
        } else {
            phaseSocietyEra();
        }
    }

    // --- í”„ë¡¤ë¡œê·¸: 19ì„¸ (ìˆ˜ëŠ¥/ì§„ë¡œ) ---
    function initGame() {
        setStory(
            "19ì„¸, ì„ íƒì˜ ì‹œê°„",
            "ìˆ˜ëŠ¥ì´ ì–¼ë§ˆ ë‚¨ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nì–´ë–»ê²Œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
        );
        setChoices([
            {
                text: "ìˆ˜ëŠ¥ì— ëª©ìˆ¨ ê±´ë‹¤",
                sub: "ë©˜íƒˆ/ê±´ê°• ê°ì†Œ, ëª…ë¬¸ëŒ€ í™•ë¥ â†‘, íˆë“ : ê³µë¶€ ì„±í–¥",
                action: () => runSuneung(true)
            },
            {
                text: "ì ë‹¹íˆ ê³µë¶€í•œë‹¤",
                sub: "ë°¸ëŸ°ìŠ¤ ìœ ì§€, ì¼ë°˜ëŒ€ ëª©í‘œ",
                action: () => runSuneung(false)
            },
            {
                text: "ìˆ˜ëŠ¥ ì•ˆ ë³¸ë‹¤",
                sub: "ë°”ë¡œ ì‚¬íšŒìƒí™œ ì‹œì‘ (ìœ íŠœë²„/ì•Œë°”)",
                action: () => skipSuneung()
            }
        ]);
        updateUI();
    }

    function runSuneung(isHard) {
        if (isHard) {
            changeStat('mental', -30);
            changeStat('health', -20);
        } else {
            changeStat('mental', -10);
        }

        if (!gameState.careerPath) {
            gameState.careerPath = 'study';
        }

        const d20 = rollD20();
        const bonus = isHard ? 6 : 0;
        const score = d20 * 5 + bonus;
        addLog(`ìˆ˜ëŠ¥ ê²°ê³¼ë¥¼ êµ´ë ¸ìŠµë‹ˆë‹¤. (d20=${d20}, ë³´ë„ˆìŠ¤=${bonus}, í™˜ì‚° ì ìˆ˜=${Math.floor(score)})`);

        let uniResult = '';
        if (score >= 110) uniResult = 'ì˜ëŒ€';
        else if (score >= 90) uniResult = 'ëª…ë¬¸ëŒ€';
        else if (score >= 50) uniResult = 'ì§€ë°©ëŒ€';
        else uniResult = 'ì¬ìˆ˜';

        setStory(
            "ìˆ˜ëŠ¥ ì„±ì  ë°œí‘œ",
            `ë…¸ë ¥ê³¼ ìš´ì˜ ê²°ê³¼...\n[${uniResult}] í•©ê²©ê¶Œì…ë‹ˆë‹¤!`
        );

        let choices = [];
        if (uniResult === 'ì¬ìˆ˜') {
            choices.push({
                text: "ì¬ìˆ˜ í•™ì› ë“±ë¡",
                sub: "1ë…„ ë” ê³µë¶€ (ë¹„ìš© 500ë§Œì›)",
                cost: 500,
                action: () => {
                    gameState.job = 'ì¬ìˆ˜ìƒ';
                    addLog("ì¬ìˆ˜ë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤.");
                    startAdultLoop();
                }
            });
            choices.push({
                text: "ì„±ì  ë§ì¶° ì•„ë¬´ ëŒ€í•™ì´ë‚˜ ê°„ë‹¤",
                sub: "ì§€ë°©ëŒ€ ì…í•™",
                action: () => {
                    gameState.university = 'ì§€ë°©ëŒ€';
                    gameState.job = 'ëŒ€í•™ìƒ';
                    gameState.degree = 'ëŒ€í•™ì¬í•™';
                    addLog("ì§€ë°©ëŒ€ì— ì…í•™í–ˆìŠµë‹ˆë‹¤.");
                    startAdultLoop();
                }
            });
        } else {
            choices.push({
                text: `${uniResult} ì…í•™`,
                sub: "ë“±ë¡ê¸ˆ ë‚©ë¶€ í•„ìš” (500ë§Œì›)",
                cost: 500,
                action: () => {
                    gameState.university = uniResult;
                    gameState.job = 'ëŒ€í•™ìƒ';
                    gameState.degree = 'ëŒ€í•™ì¬í•™';
                    addLog(`${uniResult}ì— ì…í•™í–ˆìŠµë‹ˆë‹¤.`);
                    startAdultLoop();
                }
            });
        }
        choices.push({
            text: "ëŒ€í•™ í¬ê¸°í•˜ê³  ì•Œë°” ì‹œì‘",
            sub: "ë“±ë¡ê¸ˆ ì•„ë¼ê³  ëˆ ë²Œê¸°",
            action: () => {
                gameState.job = 'ì•Œë°”';
                gameState.degree = 'ê³ ì¡¸';
                addLog("ëŒ€í•™ ì§„í•™ì„ í¬ê¸°í•˜ê³  ì•Œë°” ì „ì„ ì— ë›°ì–´ë“¤ì—ˆìŠµë‹ˆë‹¤.");
                gameState.careerPath = 'job';
                gameState.careerSkill = 1;
                startAdultLoop();
            }
        });

        setChoices(choices);
    }

    function skipSuneung() {
        setStory(
            "ìì‹ ì˜ ê¸¸ì„ ì°¾ì•„ì„œ",
            "ìˆ˜ëŠ¥ ì ìˆ˜ë³´ë‹¤ ì¤‘ìš”í•œ ê²ƒì´ ìˆìŠµë‹ˆë‹¤.\nì–´ë–¤ ê¸¸ì„ ì„ íƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
        );
        setChoices([
            {
                text: "ìœ íŠœë¸Œ í¬ë¦¬ì—ì´í„° ë„ì „",
                sub: "ì´ˆê¸° ë¹„ìš© 200, ëŒ€ë°• ì•„ë‹ˆë©´ ìª½ë°• (íˆë“ : í¬ë¦¬ì—ì´í‹°ë¸Œ ì„±í–¥)",
                cost: 200,
                action: () => {
                    gameState.job = 'ìœ íŠœë²„';
                    gameState.jobTier = 1;
                    gameState.careerPath = 'creative';
                    gameState.careerSkill = 1;
                    addLog("ìœ íŠœë¸Œ ì±„ë„ì„ ê°œì„¤í–ˆìŠµë‹ˆë‹¤. (íˆë“ : í¬ë¦¬ì—ì´í„° ì„±í–¥ Lv.1)");
                    startAdultLoop();
                }
            },
            {
                text: "ì•Œë°” í›„ ì°½ì—… ëª©í‘œ",
                sub: "ì°©ì‹¤í•˜ê²Œ ì‹œë“œë¨¸ë‹ˆ ëª¨ìœ¼ê¸° (íˆë“ : ì‚¬ì—…/ì‹¤ë¬´ ì„±í–¥)",
                action: () => {
                    gameState.job = 'ì•Œë°”';
                    gameState.degree = 'ê³ ì¡¸';
                    gameState.careerPath = 'job';
                    gameState.careerSkill = 1;
                    addLog("ì•„ë¥´ë°”ì´íŠ¸ë¥¼ ì‹œì‘í–ˆìŠµë‹ˆë‹¤. (íˆë“ : ì‹¤ë¬´ ì„±í–¥ Lv.1)");
                    startAdultLoop();
                }
            }
        ]);
    }

    function startAdultLoop() {
        gameState.age = 20;
        gameState.turnInYear = 0;
        updateUI();
        showPhaseForCurrentAge();
    }

    // --- 20~26ì„¸: ëŒ€í•™/ì´ˆë…„ìƒ ì‹œê¸° ---
    function phaseUniversityEra() {
        const isStudent = gameState.job === 'ëŒ€í•™ìƒ';

        let title = `${gameState.age}ì„¸, `;
        title += isStudent ? "ìº í¼ìŠ¤ ë¼ì´í”„" : "ì¹˜ì—´í•œ ì‚¬íšŒìƒí™œ";

        let desc = isStudent
            ? `${gameState.university} ì¬í•™ ì¤‘ì…ë‹ˆë‹¤. ì˜¬í•´ëŠ” ë¬´ì—‡ì— ì§‘ì¤‘í• ê¹Œìš”?`
            : `${gameState.job} ìƒí™œ ì¤‘ì…ë‹ˆë‹¤. ì˜¬í•´ì˜ ëª©í‘œëŠ”?`;

        let options = [];

        if (isStudent) {
            options.push({
                text: "í•™ì  ê´€ë¦¬ (ê³µë¶€ ì˜¬ì¸)",
                sub: "ì·¨ì—… ìŠ¤í™â†‘, ë©˜íƒˆâ†“, d20 íŒì •",
                action: () => {
                    resolveChoice({
                        dc: 11,
                        tag: "study",
                        description: "í•™ì  ê´€ë¦¬ë¥¼ ìœ„í•´ ê³µë¶€ì— ì˜¬ì¸í•©ë‹ˆë‹¤.",
                        onSuccess: () => {
                            changeStat('mental', -10);
                            addLog("ë„ì„œê´€ì—ì„œ ì‚´ì•˜ìŠµë‹ˆë‹¤. í•™ì  A+ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤.");
                            gameState.spec = (gameState.spec || 0) + 2;
                        },
                        onFail: () => {
                            changeStat('mental', -20);
                            addLog("ì—´ì‹¬íˆ í–ˆì§€ë§Œ ê¸°ëŒ€ë§Œí¼ ì„±ì ì´ ë‚˜ì˜¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                            gameState.spec = (gameState.spec || 0) + 1;
                        }
                    });
                    advanceTurn();
                }
            });
            options.push({
                text: "ì•Œë°”ì™€ í•™ì—… ë³‘í–‰",
                sub: "ëˆ+200, ì²´ë ¥/ë©˜íƒˆâ†“, ì„±ê³µ ì‹œ ìŠ¤í™ ì¡°ê¸ˆâ†‘",
                action: () => {
                    resolveChoice({
                        dc: 13,
                        tag: "job",
                        description: "í•™ì—…ê³¼ ì•Œë°”ë¥¼ í•¨ê»˜ í•´ëƒ…ë‹ˆë‹¤.",
                        onSuccess: () => {
                            changeMoney(200);
                            changeStat('mental', -10);
                            changeStat('health', -10);
                            addLog("ì•Œë°”ì™€ í•™ì—…ì„ ì˜ ë³‘í–‰í–ˆìŠµë‹ˆë‹¤.");
                            gameState.spec = (gameState.spec || 0) + 1;
                        },
                        onFail: () => {
                            changeMoney(100);
                            changeStat('mental', -20);
                            changeStat('health', -15);
                            addLog("ë„ˆë¬´ ë°”ë¹ ì„œ ë‘˜ ë‹¤ ì• ë§¤í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.");
                        }
                    });
                    advanceTurn();
                }
            });
            options.push({
                text: "ë‚­ë§Œ ì¦ê¸°ê¸° (ë™ì•„ë¦¬/ì—°ì• )",
                sub: "ë©˜íƒˆ íšŒë³µ, ëˆ-100, ì—°ì• ìš´ì€ d20",
                cost: 100,
                action: () => {
                    resolveChoice({
                        dc: 9,
                        tag: "social",
                        description: "ë™ì•„ë¦¬/ì—°ì• ì— ëª°ë‘í•©ë‹ˆë‹¤.",
                        onSuccess: () => {
                            changeStat('mental', 25);
                            addLog("ì¢‹ì€ ì‚¬ëŒë“¤ì„ ë§Œë‚˜ë©° ì¦ê±°ìš´ ì‹œê°„ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.");
                        },
                        onFail: () => {
                            changeStat('mental', 5);
                            addLog("ì¸ì´ íì§€ë¶€ì§€ë˜ê±°ë‚˜ ë™ì•„ë¦¬ ë‚´ ê°ˆë“±ì„ ê²ªì—ˆìŠµë‹ˆë‹¤.");
                        }
                    });
                    advanceTurn();
                }
            });
            options.push({
                text: "íœ´í•™ í›„ ì¸í„´ ê²½í—˜",
                sub: "1ë…„ íœ´í•™, ìŠ¤í™â†‘, ë¹„ìš© 200, d20",
                cost: 200,
                action: () => {
                    resolveChoice({
                        dc: 12,
                        tag: "job",
                        description: "í˜„ì¥ì—ì„œ ì¸í„´ìœ¼ë¡œ ì‹¤ë¬´ë¥¼ ë°°ì›ë‹ˆë‹¤.",
                        onSuccess: () => {
                            changeStat('mental', -5);
                            changeStat('health', -5);
                            addLog("ì¸í„´ì‹­ì—ì„œ ì‹¤ë¬´ ê²½í—˜ì„ ìŒ“ì•˜ìŠµë‹ˆë‹¤. ì·¨ì—…ì— ë„ì›€ì´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.");
                            gameState.spec = (gameState.spec || 0) + 2;
                        },
                        onFail: () => {
                            changeStat('mental', -10);
                            addLog("ì¸í„´ ìë¦¬ê°€ ìƒê°ë³´ë‹¤ ì¡ë¬´ë¿ì´ë¼ í¬ê²Œ ë„ì›€ì€ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                            gameState.spec = (gameState.spec || 0) + 1;
                        }
                    });
                    advanceTurn();
                }
            });
            options.push({
                text: "ì°½ì—… ë™ì•„ë¦¬/í”„ë¡œì íŠ¸",
                sub: "ì°½ì—… ìŠ¤í‚¬, ì‹¤íŒ¨ ì‹œ ë©˜íƒˆâ†“, ì„±ê³µ ì‹œ ìˆ˜ì…/ê²½í—˜",
                cost: 100,
                action: () => {
                    resolveChoice({
                        dc: 15,
                        tag: "creative",
                        description: "ì¹œêµ¬ë“¤ê³¼ ì‚¬ì´ë“œ í”„ë¡œì íŠ¸/ì°½ì—…ì„ ì‹œë„í•©ë‹ˆë‹¤.",
                        onSuccess: () => {
                            changeStat('mental', 10);
                            changeMoney(300);
                            addLog("ì‘ì€ ì„œë¹„ìŠ¤ê°€ íˆíŠ¸í•˜ì—¬ ì†Œì•¡ì˜ ìˆ˜ìµê³¼ ê²½í—˜ì„ ì–»ì—ˆìŠµë‹ˆë‹¤.");
                        },
                        onFail: () => {
                            changeStat('mental', -15);
                            addLog("í”„ë¡œì íŠ¸ê°€ íì§€ë¶€ì§€ë˜ë©° ë©˜íƒˆì— ìƒì²˜ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤.");
                        }
                    });
                    advanceTurn();
                }
            });

            if (gameState.age >= 24) {
                options = [{
                    text: "ì¡¸ì—… ë° ì·¨ì—… ì¤€ë¹„",
                    sub: "ì´ì œ í•™ìƒ ì‹ ë¶„ì„ ë²—ì–´ë‚©ë‹ˆë‹¤.",
                    action: () => {
                        gameState.job = 'ì·¨ì¤€ìƒ';
                        gameState.degree = 'ëŒ€ì¡¸';
                        addLog(`${gameState.university} ì¡¸ì—…. ì·¨ì¤€ìƒì´ ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                        advanceTurn();
                    }
                }];
            }
        } else {
            // ë¹„ëŒ€í•™ìƒ (ì•Œë°”, ìœ íŠœë²„, ì¬ìˆ˜ìƒ ë“±)
            options.push({
                text: "ì£½ì–´ë¼ ì¼í•˜ê¸°/ê³µë¶€í•˜ê¸°",
                sub: "ìˆ˜ì… ë˜ëŠ” ì‹¤ë ¥ ì¦ê°€, ê±´ê°•/ë©˜íƒˆâ†“",
                action: () => {
                    const isYoutuber = gameState.job === 'ìœ íŠœë²„';
                    const tag = isYoutuber ? 'creative' : 'job';
                    const dc = isYoutuber ? 14 : 11;
                    resolveChoice({
                        dc,
                        tag,
                        description: `${gameState.job}ë¡œ ë¯¸ì¹œ ë“¯ì´ ë‹¬ë¦½ë‹ˆë‹¤.`,
                        onSuccess: () => {
                            changeStat('health', -15);
                            changeStat('mental', -10);
                            const extraIncome = isYoutuber ? 400 : 300;
                            changeMoney(extraIncome);
                            addLog("ì—´ì‹¬íˆ í•œ ë§Œí¼ ê²°ê³¼ê°€ ë”°ë¼ì™”ìŠµë‹ˆë‹¤.");
                            if (isYoutuber) {
                                gameState.jobTier++;
                                addLog("ì±„ë„ ê·œëª¨ê°€ í•œ ë‹¨ê³„ ì„±ì¥í–ˆìŠµë‹ˆë‹¤!");
                            }
                        },
                        onFail: () => {
                            changeStat('health', -20);
                            changeStat('mental', -10);
                            changeMoney(200);
                            addLog("ì—´ì‹¬íˆ í–ˆì§€ë§Œ ìƒê°ë§Œí¼ ì„±ê³¼ê°€ ë‚˜ì˜¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                        }
                    });
                    advanceTurn();
                }
            });
            options.push({
                text: "ìê¸°ê³„ë°œ/íœ´ì‹",
                sub: "ë©˜íƒˆ/ê±´ê°• íšŒë³µ, ë¹„ìš© 100, ì‹¤í–‰ë ¥ì€ d20",
                action: () => {
                    resolveChoice({
                        dc: 9,
                        tag: "study",
                        description: "ìê¸°ê³„ë°œê³¼ íœ´ì‹ì˜ ê· í˜•ì„ ì¡ìŠµë‹ˆë‹¤.",
                        onSuccess: () => {
                            changeStat('mental', 25);
                            changeStat('health', 10);
                            changeMoney(-100);
                            addLog("ëª¸ê³¼ ë§ˆìŒì´ í•œê²° ê°€ë²¼ì›Œì¡ŒìŠµë‹ˆë‹¤.");
                        },
                        onFail: () => {
                            changeStat('mental', 10);
                            changeMoney(-100);
                            addLog("ê³„íšë§Œ ì„¸ìš°ê³  ì œëŒ€ë¡œ ì‹¤í–‰í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                        }
                    });
                    advanceTurn();
                }
            });

            if (gameState.degree === 'ê³ ì¡¸') {
                options.push({
                    text: "ì•¼ê°„ëŒ€/ë°©í†µëŒ€ ì…í•™ ë„ì „",
                    sub: "ì¼í•˜ë©´ì„œ í•™ìœ„ ì¤€ë¹„, d20 íŒì •",
                    cost: 300,
                    action: () => {
                        resolveChoice({
                            dc: 11,
                            tag: "study",
                            description: "ì•¼ê°„ëŒ€/ë°©í†µëŒ€ ì…í•™ ì‹œí—˜ì— ë„ì „í•©ë‹ˆë‹¤.",
                            onSuccess: () => {
                                gameState.degree = 'ëŒ€í•™ì¬í•™';
                                gameState.job = 'ëŒ€í•™ìƒ';
                                addLog("ì•¼ê°„ëŒ€/ë°©í†µëŒ€ ì…í•™ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤. ë°”ìœ ì‚¶ì´ ì‹œì‘ë©ë‹ˆë‹¤.");
                            },
                            onFail: () => {
                                changeStat('mental', -10);
                                addLog("ì…í•™ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ê¸°íšŒë¥¼ ë…¸ë¦½ë‹ˆë‹¤.");
                            }
                        });
                        advanceTurn();
                    }
                });
            }

            options.push({
                text: "ê¸°ìˆ /ìê²©ì¦ ê³µë¶€",
                sub: "ì½”ë”©, ë¯¸ìš©, ìš”ë¦¬ ë“± ì‹¤ë¬´í˜• ê¸°ìˆ  ìŠµë“",
                cost: 150,
                action: () => {
                    resolveChoice({
                        dc: 12,
                        tag: "job",
                        description: "ìê²©ì¦ ì‹œí—˜ì— ë„ì „í•©ë‹ˆë‹¤.",
                        onSuccess: () => {
                            changeStat('mental', -5);
                            addLog("ìê²©ì¦ì„ ì·¨ë“í–ˆìŠµë‹ˆë‹¤. ìŠ¤í™ì´ ì†Œí­ ìƒìŠ¹í•©ë‹ˆë‹¤.");
                            gameState.spec = (gameState.spec || 0) + 1;
                        },
                        onFail: () => {
                            changeStat('mental', -15);
                            addLog("ì‹œí—˜ì— ë–¨ì–´ì¡ŒìŠµë‹ˆë‹¤. ì•„ì‰½ì§€ë§Œ ê²½í—˜ì€ ë‚¨ì•˜ìŠµë‹ˆë‹¤.");
                        }
                    });
                    advanceTurn();
                }
            });
        }

        setStory(title, desc);
        setChoices(options);
    }

    // --- 27~30ì„¸: ì·¨ì—…/ì •ì°© ì‹œê¸° ---
    function phaseSocietyEra() {
        if (gameState.job === 'ì·¨ì¤€ìƒ') {
            setStory(
                `${gameState.age}ì„¸, ì·¨ì—… ì „ìŸ`,
                "ì´ì œ ì§ì¥ì„ êµ¬í•´ì•¼ í•©ë‹ˆë‹¤.\nì–´ë””ì— ì§€ì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
            );

            setChoices([
                {
                    text: "ëŒ€ê¸°ì—…/ì „ë¬¸ì§ ì§€ì›",
                    sub: "ë†’ì€ ì—°ë´‰, ë†’ì€ ê²½ìŸë¥  (d20 íŒì •)",
                    action: () => jobInterview('ëŒ€ê¸°ì—…', 18)
                },
                {
                    text: "ì¤‘ì†Œê¸°ì—… ì§€ì›",
                    sub: "ë¹ ë¥¸ ì·¨ì—…, ì ë‹¹í•œ ì—°ë´‰ (d20 íŒì •)",
                    action: () => jobInterview('ì¤‘ì†Œê¸°ì—…', 14)
                },
                {
                    text: "ê³µë¬´ì› ì‹œí—˜ ì¤€ë¹„",
                    sub: "1ë…„ ê³µë¶€, í•©ê²© ì‹œ ì•ˆì •ì ì¸ ì‚¶",
                    action: () => {
                        const dc = getAdjustedDc(17);
                        resolveChoice({
                            dc,
                            tag: "study",
                            description: "ê³µë¬´ì› ì‹œí—˜ì— ë„ì „í•©ë‹ˆë‹¤.",
                            onSuccess: () => {
                                gameState.job = 'ê³µë¬´ì›';
                                addLog("ê³µë¬´ì› ì‹œí—˜ì— í•©ê²©í–ˆìŠµë‹ˆë‹¤!");
                            },
                            onFail: () => {
                                changeStat('mental', -20);
                                addLog("ê³µë¬´ì› ì‹œí—˜ì— ë–¨ì–´ì¡ŒìŠµë‹ˆë‹¤. 1ë…„ì´ ë‚ ì•„ê°”ìŠµë‹ˆë‹¤.");
                            }
                        });
                        advanceTurn();
                    }
                }
            ]);
            return;
        }

        let title = `${gameState.age}ì„¸, ì‚¬íšŒìƒí™œ`;
        let desc = `ì§ì—…: ${gameState.job}\ní˜„ì¬ ìì‚°: ${gameState.money}ë§Œì›\n`;

        if (gameState.location === 'ë³¸ê°€') {
            desc += "í˜„ì¬ ë³¸ê°€ì— ì‚´ê³  ìˆìŠµë‹ˆë‹¤. ì„œìš¸ë¡œ ë…ë¦½í• ê¹Œìš”?";
        } else {
            desc += "ì„œìš¸ì—ì„œ ìì·¨ ì¤‘ì…ë‹ˆë‹¤. ë†’ì€ ë¬¼ê°€ì— í—ˆë•ì´ëŠ” ì¤‘...";
        }

        let options = [];

        options.push({
            text: "ì—…ë¬´ ì§‘ì¤‘ (ìŠ¹ì§„ ë„ì „)",
            sub: "ìŠ¤íŠ¸ë ˆìŠ¤â†‘, ì„±ê³µ ì‹œ ì—°ë´‰/ë³´ë„ˆìŠ¤â†‘",
            action: () => {
                resolveChoice({
                    dc: 13,
                    tag: "job",
                    description: "ì˜¬í•´ ìŠ¹ì§„ì„ ë…¸ë¦¬ë©° ì—…ë¬´ì— ì˜¬ì¸í•©ë‹ˆë‹¤.",
                    onSuccess: () => {
                        changeStat('mental', -15);
                        changeStat('health', -10);
                        changeMoney(400);
                        addLog("ì„±ê³¼ë¥¼ ì¸ì •ë°›ì•„ ì—°ë´‰ê³¼ ë³´ë„ˆìŠ¤ê°€ ì˜¬ëìŠµë‹ˆë‹¤.");
                    },
                    onFail: () => {
                        changeStat('mental', -25);
                        changeStat('health', -15);
                        changeMoney(200);
                        addLog("ì—´ì‹¬íˆ í–ˆì§€ë§Œ ìŠ¹ì§„ì—ëŠ” ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì²´ë ¥ê³¼ ë©˜íƒˆë§Œ ë‹³ì•˜ìŠµë‹ˆë‹¤.");
                    }
                });
                advanceTurn();
            }
        });

        options.push({
            text: "ì›Œë¼ë°¸ ì¤‘ì‹œ",
            sub: "ë©˜íƒˆ ê´€ë¦¬, ì»¤ë¦¬ì–´ëŠ” ì œìë¦¬",
            action: () => {
                resolveChoice({
                    dc: 8,
                    tag: "social",
                    description: "ì¼ê³¼ ì‚¶ì˜ ê· í˜•ì„ ë§ì¶°ë´…ë‹ˆë‹¤.",
                    onSuccess: () => {
                        changeStat('mental', 20);
                        addLog("ì·¨ë¯¸ ìƒí™œê³¼ ì¸ê°„ê´€ê³„ë¥¼ ì˜ ìœ ì§€í–ˆìŠµë‹ˆë‹¤.");
                    },
                    onFail: () => {
                        changeStat('mental', 5);
                        addLog("ì¼ì´ ìƒê°ë³´ë‹¤ ë§ì•„ ì¶©ë¶„íˆ ì‰¬ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                    }
                });
                advanceTurn();
            }
        });

        if (gameState.location === 'ë³¸ê°€') {
            options.push({
                text: "ì„œìš¸ë¡œ ë…ë¦½ (ì´ì‚¬)",
                sub: "ììœ â†‘, ì›”ì„¸ ë°œìƒ(ì—° 600)",
                cost: 1000,
                action: () => {
                    resolveChoice({
                        dc: 10,
                        tag: "social",
                        description: "ì„œìš¸ ìƒí™œì— ì ì‘í•  ìˆ˜ ìˆì„ê¹Œìš”?",
                        onSuccess: () => {
                            gameState.location = 'ì„œìš¸ìì·¨';
                            changeStat('mental', 30);
                            addLog("ì„œìš¸ë¡œ ë…ë¦½í–ˆìŠµë‹ˆë‹¤! ììœ ì™€ ì„¤ë ˜ì´ ê°€ë“í•©ë‹ˆë‹¤.");
                        },
                        onFail: () => {
                            gameState.location = 'ì„œìš¸ìì·¨';
                            changeStat('mental', 10);
                            addLog("ì„œìš¸ë¡œ ì´ì‚¬í–ˆì§€ë§Œ ì™¸ë¡œì›€ê³¼ ë†’ì€ ë¬¼ê°€ì— ê³ ìƒí•©ë‹ˆë‹¤.");
                        }
                    });
                    advanceTurn();
                }
            });
        } else {
            options.push({
                text: "ë³¸ê°€ë¡œ ê·€í™˜ (ë‚™í–¥)",
                sub: "ì›”ì„¸ ì ˆì•½, ì”ì†Œë¦¬â†‘",
                action: () => {
                    resolveChoice({
                        dc: 9,
                        tag: "social",
                        description: "ë³¸ê°€ ìƒí™œì— ì ì‘í•©ë‹ˆë‹¤.",
                        onSuccess: () => {
                            gameState.location = 'ë³¸ê°€';
                            addLog("ë³¸ê°€ ìƒí™œì— ì ì‘í•˜ë©° ê°€ì¡±ê³¼ì˜ ì‹œê°„ì„ ë³´ëƒ…ë‹ˆë‹¤.");
                        },
                        onFail: () => {
                            gameState.location = 'ë³¸ê°€';
                            changeStat('mental', -5);
                            addLog("ì”ì†Œë¦¬ì™€ ê°„ì„­ì´ ìŠ¤íŠ¸ë ˆìŠ¤ë¡œ ë‹¤ê°€ì˜µë‹ˆë‹¤.");
                        }
                    });
                    advanceTurn();
                }
            });
        }

        if (gameState.age === 29) {
            title = "29ì„¸, ì¤‘ëŒ€ ê²°ì •";
            desc = "ê²°í˜¼ ì ë ¹ê¸°ì…ë‹ˆë‹¤. ëª¨ì•„ë‘” ëˆì„ ê²°í˜¼ì— ì“°ì‹œê² ìŠµë‹ˆê¹Œ?";
            options = [
                {
                    text: "ê²°í˜¼ í•œë‹¤ (ìê¸ˆ ì†Œëª¨)",
                    sub: "ë¹„ìš© 5000, d20ìœ¼ë¡œ í”„ëŸ¬í¬ì¦ˆ/ì¤€ë¹„ íŒì •",
                    action: () => {
                        if (gameState.money < 3000) {
                            showToast("ê²°í˜¼ ìê¸ˆì´ ë¶€ì¡±í•´ ê±°ì ˆë‹¹í–ˆìŠµë‹ˆë‹¤...");
                            changeStat('mental', -30);
                            addLog("ìê¸ˆ ë¶€ì¡±ìœ¼ë¡œ ê²°í˜¼ì´ ë¬´ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤.");
                            advanceTurn();
                            return;
                        }
                        resolveChoice({
                            dc: 12,
                            tag: "social",
                            description: "ê²°í˜¼ ì¤€ë¹„ì™€ í”„ëŸ¬í¬ì¦ˆë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.",
                            onSuccess: () => {
                                changeMoney(-5000);
                                changeStat('mental', 40);
                                gameState.isMarried = true;
                                addLog("ê²°í˜¼ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤! ìƒˆë¡œìš´ ê°€ì •ì´ ì‹œì‘ë©ë‹ˆë‹¤.");
                            },
                            onFail: () => {
                                changeMoney(-1000);
                                changeStat('mental', -40);
                                addLog("ê´€ê³„ê°€ í‹€ì–´ì§€ë©° ê²°í˜¼ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤...");
                            }
                        });
                        advanceTurn();
                    }
                },
                {
                    text: "ë¹„í˜¼ ìœ ì§€",
                    sub: "ììœ ë¡œìš´ ì‚¶, ì™¸ë¡œì›€?",
                    action: () => {
                        addLog("í™”ë ¤í•œ ì‹±ê¸€ ë¼ì´í”„ë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤.");
                        advanceTurn();
                    }
                }
            ];
        }

        setStory(title, desc);
        setChoices(options);
    }

    function jobInterview(targetJob, baseDc) {
        const dc = getAdjustedDc(baseDc);
        resolveChoice({
            dc,
            tag: "study",
            description: `${targetJob} ë©´ì ‘ì— ë„ì „í•©ë‹ˆë‹¤.`,
            onSuccess: () => {
                gameState.job = targetJob;
                if (targetJob === 'ëŒ€ê¸°ì—…' || targetJob === 'ì „ë¬¸ì§') {
                    changeMoney(1000);
                }
                addLog(`${targetJob}ì— ìµœì¢… í•©ê²©í–ˆìŠµë‹ˆë‹¤!`);
            },
            onFail: () => {
                changeStat('mental', -20);
                addLog(`${targetJob} ë©´ì ‘ì—ì„œ íƒˆë½í–ˆìŠµë‹ˆë‹¤...`);
            }
        });
        advanceTurn();
    }

    // --- 1ë…„ ë‚´ 4íšŒ í–‰ë™ ê´€ë¦¬ ---
    function advanceTurn() {
        if (gameState.isGameOver) return;

        gameState.turnInYear++;

        if (gameState.turnInYear >= gameState.turnsPerYear) {
            // ì—°ë§
            gameState.turnInYear = 0;
            processAnnualEvent();

            // ì—°ë§ ì •ì‚° í›„ ê²Œì„ ì˜¤ë²„ ì¡°ê±´ í•œ ë²ˆ ë” ì²´í¬
            if (checkGameOver()) return;

            gameState.age++;
            if (gameState.age > gameState.maxAge) {
                endGame("30ì„¸ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.");
                return;
            }
        }

        updateUI();
        showPhaseForCurrentAge();
    }


    // --- ì—”ë”© ---
    function endGame(reason) {
        gameState.isGameOver = true;
        ui.endingModal.classList.remove('hidden');

        let endTitle = "í‰ë²”í•œ ì‹œë¯¼";
        if (gameState.money > 20000) endTitle = "ììˆ˜ì„±ê°€ ë¶€ì";
        else if (gameState.money < -2000) endTitle = "ì‹ ìš©ë¶ˆëŸ‰ì";

        if ((gameState.job === 'ì˜ì‚¬' || gameState.job === 'ëŒ€ê¸°ì—…' || gameState.job === 'ì „ë¬¸ì§')) {
            endTitle += " ì—˜ë¦¬íŠ¸";
        }
        if (gameState.job === 'ìœ íŠœë²„' && gameState.jobTier > 2) endTitle = "ë°±ë§Œ ìœ íŠœë²„";
        if (gameState.stats.mental < 30) endTitle = "ë²ˆì•„ì›ƒ ì˜¨ " + endTitle;
        if (gameState.isMarried) endTitle = "ê°€ì •ì„ ì´ë£¬ " + endTitle;
        if (gameState.careerSkill >= 3) endTitle += " (ì¥ì¸ ì •ì‹ )";

        let html = `
            <p class="text-xl font-bold text-indigo-600 mb-4">"${endTitle}"</p>
            <div class="bg-gray-100 p-4 rounded text-left space-y-2">
                <p><strong>ì¢…ë£Œ ì‚¬ìœ :</strong> ${reason}</p>
                <p><strong>ìµœì¢… ìì‚°:</strong> ${gameState.money.toLocaleString()}ë§Œì›</p>
                <p><strong>ìµœì¢… ì§ì—…:</strong> ${gameState.job}</p>
                <p><strong>ìµœì¢… ë©˜íƒˆ:</strong> ${gameState.stats.mental}</p>
                <p><strong>ê±°ì£¼ì§€:</strong> ${gameState.location}</p>
                <p><strong>ê²°í˜¼ ì—¬ë¶€:</strong> ${gameState.isMarried ? 'ê¸°í˜¼' : 'ë¯¸í˜¼'}</p>
                <p><strong>íˆë“  ì§„ë¡œ ì ì„±:</strong> ${gameState.careerPath || 'ë¯¸ì •'} / Lv.${gameState.careerSkill}</p>
            </div>
            <div class="mt-4">
                <p class="font-bold mb-2">ì¸ìƒ ì£¼ìš” ê¸°ë¡:</p>
                <ul class="list-disc pl-5 text-gray-600 text-xs">
                    ${gameState.history.slice(-5).map(h => `<li>${h}</li>`).join('')}
                </ul>
            </div>
        `;
        ui.endingContent.innerHTML = html;
    }

    // --- ì‹œì‘ ë²„íŠ¼ ---
    document.querySelector('button').onclick = () => {
        gameState.age = 19;

        // ğŸ² ì‹œì‘ ìê¸ˆ ëœë¤ ì§€ê¸‰
        const startMoney = getRandomStartMoney();
        gameState.money = startMoney;

        gameState.stats = { mental: 80, health: 80, hunger: 80 };
        gameState.job = 'ê³ 3 í•™ìƒ';
        gameState.history = [];
        gameState.location = 'ë³¸ê°€';
        gameState.isGameOver = false;
        gameState.university = null;
        gameState.degree = 'ê³ ì¡¸';
        gameState.jobTier = 0;
        gameState.spec = 0;
        gameState.careerPath = null;
        gameState.careerSkill = 0;
        gameState.isMarried = false;
        gameState.turnInYear = 0;

        ui.log.innerHTML = '';
        ui.log.classList.add('hidden');

        updateUI();
        showToast(`ì´ˆê¸° ìê¸ˆ ${startMoney.toLocaleString()}ë§Œì›ìœ¼ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.`);
        initGame();
    };

    // ì´ˆê¸° UI ë Œë”ë§
    updateUI();
</script>
</body>
</html>